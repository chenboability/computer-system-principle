# review

## 总结：

控制流的完整性（Control-Flow Integrity）是一种用于保护C/C++免受代码重用攻击的技术，为了减少CFI带来的性能负担，不少实际化的上下文不敏感CFI对限制条件进行弱化，因此给攻击者提供了可乘之机。为此，这篇文章针对Context-sensitive CFI(CCFI)，提出了一个可用于现实应用程序的高效、可靠、实用的上下文敏感CFI方案，即PathArmor。对PathArmor的评估结果表明，与传统的CFI相比，PathArmor不仅取得了更加优越的安全性，同时其带来的性能影响（如内存、运行时间等）也是非常小的，因而非常适合实际部署。

上下文敏感的CFI（Context-sensitive CFI）是对整个控制流转移路径进行检查的，因而可以对前向和后向边提供更为强大的验证。然而，将其运用到实际中将需要面对3个挑战，即如何在运行时高效持续地对控制流转移进行监控，如何高效地对CFG进行静态分析以识别合法路径并抑制路径爆炸问题，如何对控制流转移攻击进行检测。

PathArmor的实现：PathArmor是由三部分组成的，分别是内核模块、静态分析器和Instrumentation组件。当执行某些敏感的系统调用时，内核模块中的系统调用拦截器收集LBR数据，然后上传给静态分析器，同时将路径的哈希保存在cache中，提高路径验证的效率。此外，还提供了分支记录内核（LBR API）来对分支进行追踪以及在库执行期间关闭分支记录。路径分析器用于运行时对特定的路径合法性进行验证，首先通过对二进制文件进行分析，以上下文敏感方式构建一个CFG。接着，为解决路径爆炸问题，对CFG进行剪枝，删除冗余的间接边和过程间的直接边，利用调用/返回匹配摒弃不合理的边。最后，对于一个给定路径，采用深度优先搜寻算法，在CFG中搜索以验证路径的合法性，并将验证结果通知内核模块完成验证。Instrumentation通过一个加载器来配置PathArmor的环境，定位程序入口main函数，并采集PLT、GOT和基地址。Dyninst框架被用来对程序中的库函数进行重写，在运行时插入代码片以确保在执行前发送关闭LBR请求并在结束后重写开启。

实验部署：PathArmor是部署在x86-64位Linux系统上，支持多进程多线程，内核模块作为Linux标准可加载模块，而静态分析器和instrumentation则是作为Dyninst框架的插件部署的。

实验评估：安全性方面，CCFI的合法target数目更少，且有着更长的最小gadget长度，因而对攻击者来说限制了gadget的数量和质量，取得了更好的安全性。此外，未来的硬件拓展（更多LBR）可以进一步提高安全性。内存的利用只是稍微增加，特别是cache只增加2 KB。运行时的时间增加也是非常少，显示了路径cache在节省搜索方面的优越性。

二、观点：

（1）优点：

1. 克服了上下文不敏感CFI难以实用化的困难，提出了PathArmor，既提供了更好的安全保障，又避免产生过多的性能负担；
2. PathArmor中运用了比较多的技术来对路径搜索进行优化，如CFG剪枝、cache机制等，既节约了内存空间，又提高了搜索效率，从而为实际化部署提供了可能性；

（2）缺点：

1. PathArmor对商用硬件的依赖度较高，因此难以支持某些系统，可拓展性较差；
2. 对前向/后向边的上下文敏感性检查还是比较弱（轻量级），虽然降低了对性能的影响，但也不能提供更好的安全性，容易被攻击者绕过。
