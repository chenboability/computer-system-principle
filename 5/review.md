# review

## 小结

为阐明库操作系统（library OS）能在SGX上运行未修改的应用程序，且不会对运行性能及安全性（TCB的大小）产生太大的影响，本文提出了Graphene-SGX的解决方案，同时也提出了一些实用性的功能改进。

系统设计：系统认为不可信的部分包括了，除CPU外的硬件，操作系统、hypervisor等软件，同一主机上的应用程序以及在进程内但在enclave外的用户空间组件；信任的是CPU以及运行在enclave内的代码。系统中的每一个应用程序都有一份表单（manifest），用于列举可用的系统资源，保护应用程序免受恶意文件系统的损害（通过检查文件的安全哈希）。Graphene-SGX将对多进程的支持拓展到enclave，在每一个enclave上运行一个带有库操作系统实例的进程，同时通过局部验证（local attestation）来验证不同的enclave，建立安全链接，并提供一种机制来安全地fork到新的enclave中。

保护Linux抽象：Graphene-SGX实现了动态加载和运行时链接机制，manifest指导enclave初始化加载和对组件的验证，之后通过bootloader动态加载。为支持ELF格式，简单地将enclave内存页模式指定为可读、可写、可执行；enclave的地址空间是位置依赖的，为了不包含地址0，Graphene-SGX将不对其进行内存映射。Graphene-SGX提供了28个enclave接口，分为4种安全级别。为了对文件进行安全验证，在第一次打开时，会根据签名的manifest对文件进行SHA256哈希验证并缓存对应的Merkle tree。内存分配上，manifest会指定应用程序所拥有的堆空间大小。线程方面只支持1:1线程模型。异常处理方面，目前要先经过不可信的OS，性能低且安全性差，未来将探索将异常直接在enclave处理的方案。Graphene-SGX利用消息传递机制在enclave上实现了多进程支持。当创建新进程时，父子进程将交换秘钥并产生局部验证报告用于验证彼此，然后在RPC流上建立TLS连接，最后父进程发送自身快照给子进程用于恢复。进程间通信是通过加密的消息传递方式来实现的。

性能评估：为评估Graphene-SGX的性能，以Linux和Graphene作为评估的基准。服务器应用程序上，选取了Lighttpd、Apache和NGINX三个任务来评估性能延迟和吞吐量，命令行程序上，选取了R、GCC和CURL三个任务来评估性能延迟。评估结果表明虽带来较大的延迟和限制了峰值吞吐量，但是仍在可接受范围内，且具有进一步提升的空间。安全性方面，Graphene-SGX的TCB中主要的代码量来源于libc，其他方面是与SCONE 和Panoply处于同一量级的。

##观点：

优点：

1. 提出了Graphene-SGX框架，验证了库操作系统在SGX上运行未修改的应用程序并不会对运行性能及安全性产生无法接受的影响，从而避免了代码重构；
2. 为多进程提供了较为完备和丰富的系统功能。

缺点：

1. 为支持ELF格式，没有提供对页保护模式的修改，而是简单粗暴地将enclave内存页模式指定为可读、可写、可执行，带来较大的安全隐患；
2. 将execve可执行的文件限制为只执行manifest中指定的可信文件，不利于实际应用；
3. 从实验评估的结果看，Graphene-SGX对性能的影响还是偏大的。

